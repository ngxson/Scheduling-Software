<div id="course"></div>
<div id="form"></div>
<script>
var arrayOfcourse;
listcourse();
function listcourse(){
	getcourse();
	var tableContent="<table><tr><th>Code</th><th>Name</th><th>Credit</th><th>Group</th><th>Degree Program</th></tr>";
	console.log(arrayOfcourse);
	for(var i=0;i<arrayOfcourse.length;i++){
		tableContent+= "<tr><td>" + arrayOfcourse[i].code +"</td><td>" + arrayOfcourse[i].name+"</td><td>"+getstudent_group(arrayOfcourse[i].code)+"</td><td>"+getstudent_group(arrayOfcourse[i].degree_program)+"</td>" ;
		//add edit and delete
		tableContent+="<td><button onClick=edit('" +arrayOfcourse[i].url+ "')>Edit</button></td><td><button onClick=deleteC('" +arrayOfcourse[i].url+ "')>Delete</button></td></tr>";
	}
	tableContent+= "</table>";
	console.log(tableContent);
	document.getElementById("course").innerHTML = tableContent;
}
function getcourse(){
	var request = new XMLHttpRequest();
	request.open("GET", "http://localhost:8000/courses/", false);
	//var user_and_pass = document.getElementById("user").value + ":" +  document.getElementById("password").value;
	request.setRequestHeader("Authorization", "Basic " + btoa("admin:password123"));
	request.send();
	arrayOfCustomers = JSON.parse(request.responseText);
}
function getstudent_group(){
	var request = new XMLHttpRequest();
	request.open("GET", "http://localhost:8000/studentgroups/", false);
	//var user_and_pass = document.getElementById("user").value + ":" +  document.getElementById("password").value;
	request.setRequestHeader("Authorization", "Basic " + btoa("admin:password123"));
	request.send();
	return JSON.parse(request.responseText);
}
function getcourse(url){
	var request = new XMLHttpRequest();
	request.open("GET", url, false);
	//var user_and_pass = document.getElementById("user").value + ":" +  document.getElementById("password").value;
	request.setRequestHeader("Authorization", "Basic " + btoa("admin:password123"));
	request.send();
	arrayOfCustomer = JSON.parse(request.responseText);
	return arrayOfCustomer;
}
function getstudent_group(url){
	var request = new XMLHttpRequest();
	request.open("GET", url, false);
	//var user_and_pass = document.getElementById("user").value + ":" +  document.getElementById("password").value;
	request.setRequestHeader("Authorization", "Basic " + btoa("admin:password123"));
	request.send();
	arrayOfCity = JSON.parse(request.responseText);
	return(arrayOfCity.name);
}
function edit(url){
	if(url!=null){
		var customer = getcourse(url);
		//create form
		var f = document.createElement("form");
		f.setAttribute("id", "customerForm");
		var i = document.createElement("input"); //input element, text
		i.setAttribute('curriculumid',"text");
		i.setAttribute('code',course.code);
		i.setAttribute('name',course.name);
		i.setAttribute('credit',course.credit);
		i.setAttribute('name',"name");
		var h = document.createElement("input"); //input element, text
		h.setAttribute('type',"hidden");
		h.setAttribute('value',course.url);
		h.setAttribute('name',"url");
		f.appendChild(h);
		var l = document.createElement("label"); //input element, text
		l.innerHTML = "Name";
		f.appendChild(l);
		l.setAttribute("for",i);
		f.appendChild(i);
		f.appendChild(document.createElement("br"));
		var l2 = document.createElement("label"); //input element, text
		l2.innerHTML = "student_group";
		f.appendChild(l2);
		var i2 = document.createElement("select");
		i2.setAttribute('name',"student_group");
		var student_group = getstudent_group();
		for(var i=0;i<student_group.length;i++){
			var o2 = document.createElement("option");
			o2.text = student_group[i].name;
			o2.value = student_group[i].url;
			i2.add(o2);
			f.appendChild(i2);
		}
		f.appendChild(document.createElement("br"));
		var b = document.createElement("button"); //input element, text
		var buttonurl = "save('" + url + "')";
		b.setAttribute('onClick',buttonurl);
		b. innerHTML ="Save course";
		f.appendChild(b);
		console.log(String(f));
		document.getElementById("form").appendChild(f);
	}
}
function deleteC(url){
	alert("Delete " +url);
}
function save(url){
	var courseJson = {};
	customerJson.url = document.getElementById("courseForm").elements["url"].value;
	customerJson.code = document.getElementById("courseForm").elements["code"].value;
	customerJson.name = document.getElementById("courseForm").elements["name"].value;
	//alert(JSON.stringify(customerJson));
	var request = new XMLHttpRequest();
	request.open("PUT", url, false);
	request.setRequestHeader("Authorization", "Basic " + btoa("admin:password123"));
	request.setRequestHeader("X-CSRFToken", readCookie("csrftoken"));
	request.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
	request.send(JSON.stringify(customerJson)); 
	//alert(request.response);
	window.location = "localhost:8000/courses"; 
}
function readCookie(name) {
 var nameEQ = encodeURIComponent(name) + "=";
 var ca = document.cookie.split(';');
 for (var i = 0; i < ca.length; i++) {
 var c = ca[i];
 while (c.charAt(0) === ' ') c = c.substring(1, c.length);
 if (c.indexOf(nameEQ) === 0) return decodeURIComponent(c.substring(nameEQ.length, c.length));
 }
 return null;
}
</script>